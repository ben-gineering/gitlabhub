# GitLab-GitHub Mirror Setup

A bash script that creates a new GitLab repository with automatic push mirroring to GitHub.

## Features

- ✅ Creates GitLab repository (main repo)
- ✅ Creates GitHub repository (mirror)
- ✅ Configures push mirroring (GitLab → GitHub) via GitLab API
- ✅ Initializes local git repository
- ✅ Sets up remotes: `origin` (GitLab), `mirror` (GitHub)
- ✅ Configurable visibility (public/private)
- ✅ Automatic first commit and push

## Requirements

- **glab** (GitLab CLI) - [Installation docs](https://glab.readthedocs.io/en/latest/install.html)
- **gh** (GitHub CLI) - [Installation docs](https://cli.github.com/manual/installation)
- GitLab account with API access
- GitHub account

### Authentication

Both CLIs must be authenticated before running the script:

```bash
# Authenticate with GitHub
gh auth login

# Authenticate with GitLab
glab auth login
```

## Installation

```bash
# Clone or download the script
git clone https://github.com/yourusername/gitlabhub.git
cd gitlabhub

# Make it executable
chmod +x setup-mirror.sh

# Optional: Add to PATH for global access
sudo cp setup-mirror.sh /usr/local/bin/setup-mirror
```

## Usage

```bash
# Create a new public project
./setup-mirror.sh my-project

# Create a private project
./setup-mirror.sh --private my-secret-project

# Create a public project (explicit)
./setup-mirror.sh --public my-open-project

# Show help
./setup-mirror.sh --help
```

## What It Does

When you run `setup-mirror.sh my-project`:

1. **Creates project folder** - Creates `my-project/` directory and enters it
2. **Checks dependencies** - Verifies glab, gh, and git are installed
3. **Checks authentication** - Confirms both CLIs are logged in
4. **Creates GitHub repo** - Creates `my-project` on GitHub (public by default)
5. **Creates GitLab repo** - Creates `my-project` on GitLab
6. **Initializes git** - Creates local git repo with empty initial commit
7. **Configures remotes**:
   - `origin` → git@gitlab.com:username/my-project.git
   - `mirror` → git@github.com:username/my-project.git
8. **Pushes to GitLab** - Pushes initial commit to GitLab
9. **Configures mirroring** - Sets up push mirroring via GitLab API

## Environment Variables

The script uses these environment variables:

| Variable | Description | Required |
|----------|-------------|----------|
| `GITLAB_TOKEN` | GitLab personal access token with `api` scope | Yes (via glab config) |
| `GITHUB_TOKEN` | GitHub personal access token with `repo` scope | Yes (via gh config) |

Both tokens are typically stored in your CLI configuration, not as environment variables.

## Mirror Configuration

The script configures **push mirroring** from GitLab to GitHub:

- **Direction**: GitLab → GitHub
- **Frequency**: Automatic within 5 minutes of push
- **Branches**: All branches mirrored
- **Protected branches**: Not limited (configurable in script)

You can modify these settings in the `configure_push_mirror()` function.

## Workflow

After running the script:

```bash
# Make changes
echo "# My Project" > README.md
git add .
git commit -m "Initial commit with README"
git push origin main

# Changes automatically mirror to GitHub
# Check GitHub after ~5 minutes
```

## Directory Structure

After running the script, your project structure:

```
my-project/
├── .git/
├── README.md  (auto-generated by GitHub)
└── (your files)
```

## Troubleshooting

### "Repository name is required"

Make sure you provide a project name as an argument:
```bash
./setup-mirror.sh my-project
```

### "glab is not installed"

Install glab first:
```bash
# macOS
brew install glab

# Linux
sudo apt install glab
```

### "GitLab not authenticated"

Run authentication:
```bash
glab auth login
```

### "Failed to configure push mirroring"

This might happen if:
1. Your GitLab token doesn't have `api` scope
2. You don't have Maintainer permissions on the project

Manual configuration:
1. Go to https://gitlab.com/username/project/-/settings/repository
2. Scroll to "Mirroring repositories"
3. Add: `https://github.com/username/project.git`
4. Select "Push" direction
5. Authenticate with GitHub personal access token

## Customization

### Change Default Visibility

Edit the `main()` function:
```bash
# Change from public (default) to private
# In main():
# local visibility="private"  # Change this line
```

### Modify Mirror Settings

Edit `configure_push_mirror()` function:

```bash
# Only mirror protected branches
--field "only_protected_branches=true"

# Keep divergent refs
--field "keep_divergent_refs=true"
```

### Add .gitignore or License

Modify `create_github_repo()` to add:
```bash
gh repo create "$repo_name" \
    --public \
    --gitignore "Node" \
    --license "MIT" \
    ...
```

## License

MIT License - feel free to use and modify!

## Contributing

Issues and pull requests welcome!